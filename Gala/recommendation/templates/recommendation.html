{% extends 'base.html' %}
{% load static %}

{% block content %}
<body class="imnida" style="background: linear-gradient(to bottom, #add8e6, #ffffff);">
    <div class="main-content" style="background: linear-gradient(to bottom, #add8e6, #ffffff); min-height: 100vh; position: relative; padding: 20px;">
        <div class="container py-4">
            <!-- Header Section -->
            <h1 class="text-center mb-4" style="color: #d83f3f; font-family: 'Merriweather', serif; font-weight: bold; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.4);">
                üéÑ Location Recommendations üéÅ
            </h1>
            <h2 class="text-center mb-4" style="color: #d83f3f; font-family: 'Merriweather', serif; font-weight: bold; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.4);">
                Within a 1000-meter radius
            </h2>

            <!-- Current Location Input -->
            <div class="row justify-content-center mb-4">
                <div class="col-md-8">
                    <div class="input-group">
                        <input type="text" id="current-location" class="form-control" 
                               placeholder="Enter your current location (Latitude, Longitude)"
                               style="border: 2px solid #ffffff; border-radius: 20px 0 0 20px; padding: 10px;">
                        <button id="locate-me" class="btn" 
                                style="background-color: #ffffff; color: #d83f3f; border-radius: 0 20px 20px 0; font-weight: bold;">
                            Use My Location
                        </button>
                    </div>
                </div>
            </div>

            <!-- Search Bar -->
            <div class="row justify-content-center mb-4">
                <div class="col-md-8">
                    <input type="text" id="location-search" class="form-control"
                           placeholder="Search for locations..."
                           style="border: 2px solid #ffffff; border-radius: 20px; padding: 10px;">
                </div>
            </div>

            <!-- Locations Grid -->
            <div id="locations-container" class="row g-4">
                {% for location in locations %}
                <div class="col-12 col-sm-6 col-md-4 col-lg-3 location-card" 
                    data-name="{{ location.name|lower }}" 
                    data-description="{{ location.description|lower }}">
                    <div class="card h-100 shadow-sm" 
                        style="border: 2px solid #ffffff; border-radius: 15px; background-color: rgba(255, 255, 255, 0.9);">
                        <div class="card-body" style="color: #333;">
                            <h5 class="card-title" style="color: #d83f3f; font-weight: bold; font-family: 'Merriweather', serif;">
                                {{ location.name }}
                            </h5>
                            <p class="card-text" style="font-style: italic;">{{ location.description }}</p>
                            <ul class="list-unstyled" style="font-size: 0.9rem;">
                                <li><strong>Longitude:</strong> {{ location.longitude }}</li>
                                <li><strong>Latitude:</strong> {{ location.latitude }}</li>
                                <li><strong>Weather:</strong> {{ location.weather }}</li>
                            </ul>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="col-12 text-center">
                    <p style="color: #ffffff; font-weight: bold; font-size: 1.2rem; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.4);">
                        üéÖ No locations found matching your search. Try again! ü§∂
                    </p>
                </div>
                {% endfor %}
            </div>

        </div>
    </div>

    <script>
        // Dynamic Search Functionality
        document.getElementById('location-search').addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const locationCards = document.querySelectorAll('.location-card');
            
            locationCards.forEach(card => {
                const name = card.dataset.name;
                const description = card.dataset.description;
                
                if (searchTerm === '' || name.includes(searchTerm) || description.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        });

        // Geolocation Button
        document.getElementById('locate-me').addEventListener('click', function() {
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    const latitude = position.coords.latitude;
                    const longitude = position.coords.longitude;
                    document.getElementById('current-location').value = `${latitude}, ${longitude}`;
                    
                    // Here you would typically call a function to filter locations
                    // based on the current location and 1000-meter radius
                    filterLocationsByProximity(latitude, longitude);
                }, function(error) {
                    alert('Error getting location: ' + error.message);
                });
            } else {
                alert('Geolocation is not supported by your browser');
            }
        });

        // Function to filter locations by proximity (placeholder)
        function filterLocationsByProximity(currentLat, currentLon) {
            const locationCards = document.querySelectorAll('.location-card');
            
            locationCards.forEach(card => {
                const lat = parseFloat(card.querySelector('li:nth-child(2)').textContent.split(': ')[1]);
                const lon = parseFloat(card.querySelector('li:nth-child(1)').textContent.split(': ')[1]);
                
                // Haversine formula to calculate distance
                const R = 6371; // Radius of the Earth in kilometers
                const dLat = (lat - currentLat) * Math.PI / 180;
                const dLon = (lon - currentLon) * Math.PI / 180;
                const a = 
                    Math.sin(dLat/2) * Math.sin(dLat/2) +
                    Math.cos(currentLat * Math.PI / 180) * Math.cos(lat * Math.PI / 180) * 
                    Math.sin(dLon/2) * Math.sin(dLon/2);
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
                const distance = R * c * 1000; // Convert to meters
                
                // Show only locations within 1000 meters
                if (distance <= 1000) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }
    </script>
</body>
{% endblock %}