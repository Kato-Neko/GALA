{% extends 'base.html' %}

{% block content %}
<style>
    body {
        padding-top: 120px;
        padding-bottom: 80px;
    }

    .container {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
    }

    #reminder-list {
        width: 30%;
        margin-right: 20px;
    }

    #calendar {
        width: 65%;
    }
    
</style>

<div class="container">
    <!-- Reminders List -->
    <div id="reminder-list">
        <h2 class="text-xl font-bold mb-4 text-center">Upcoming Events</h2>
        <ul class="space-y-4">
            {% for reminder in object_list|dictsort:"date" %}
            <li class="p-4 bg-gray-100 rounded-lg shadow-md">
                <div>
                    <h3 class="text-lg font-bold">{{ reminder.description }}</h3>
                    <p class="text-sm text-gray-600">Date: {{ reminder.date }}</p>
                    <p class="text-sm text-gray-600">Time: {{ reminder.start_time }} - {{ reminder.end_time }}</p>
                </div>
            </li>
            {% empty %}
            <li class="p-4 bg-gray-100 rounded-lg shadow-md">
                <p class="text-center text-gray-500">No reminders found.</p>
            </li>
            {% endfor %}
        </ul>
    </div>

    <!-- Calendar -->
    <div id="calendar"></div>
</div>

<!-- Create Reminder Modal -->
<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden" id="reminder-modal">
    <div class="bg-white p-8 rounded-lg shadow-lg max-w-sm w-full">
        <h2 class="text-xl font-bold mb-4">Create Reminder</h2>
        <form method="post" action="{% url 'reminder-create' %}" id="reminder-form">
            {% csrf_token %}
            <label for="description" class="block text-sm font-medium mb-2">Description:</label>
            <input type="text" name="description" required class="w-full p-2 mb-4 border rounded-md">

            <label for="start_time" class="block text-sm font-medium mb-2">Start Time:</label>
            <input type="time" name="start_time" required class="w-full p-2 mb-4 border rounded-md">

            <label for="end_time" class="block text-sm font-medium mb-2">End Time:</label>
            <input type="time" name="end_time" required class="w-full p-2 mb-4 border rounded-md">

            <input type="hidden" name="date" id="selected-date">

            <button type="submit" class="w-full bg-blue-500 text-white py-2 rounded-md hover:bg-blue-700">Save</button>
        </form>
        <button class="w-full mt-4 bg-red-500 text-white py-2 rounded-md hover:bg-red-700" onclick="closeCreateModal()">Close</button>
    </div>
</div>

<!-- View Reminder Modal -->
<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden" id="view-reminder-modal">
    <div class="bg-white p-8 rounded-lg shadow-lg max-w-sm w-full">
        <h2 class="text-xl font-bold mb-4">Reminder Details</h2>
        <div id="reminder-details">
            <!-- Reminder details will be populated dynamically -->
        </div>
        <div class="flex justify-between mt-4">
            <a id="edit-reminder-link" class="px-4 py-2 bg-yellow-500 text-white rounded-md hover:bg-yellow-700">Edit</a>
            <a id="delete-reminder-link" class="px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-700">Delete</a>
        </div>
        <button class="w-full mt-4 bg-gray-500 text-white py-2 rounded-md hover:bg-gray-700" onclick="closeViewModal()">Close</button>
    </div>
</div>

<script>
    $(document).ready(function () {
        $('#calendar').fullCalendar({
            header: {
                left: 'prev,next today',
                center: 'title',
                right: 'month,agendaWeek,agendaDay'
            },
            events: {{ events|safe }},
            dayClick: function (date, jsEvent, view) {
                const today = moment().startOf('day');
                if (date.isBefore(today)) {
                    alert("You cannot create a reminder for a past date.");
                    return;
                }
                openCreateModal(date.format());
            },
            eventClick: function (event, jsEvent, view) {
                openViewModal(event);
            }
        });
    });

    function openCreateModal(date) {
        document.getElementById('selected-date').value = date;
        document.getElementById('reminder-modal').classList.remove('hidden');
    }

    function closeCreateModal() {
        document.getElementById('reminder-modal').classList.add('hidden');
    }

    function openViewModal(event) {
        const reminderDetails = document.getElementById('reminder-details');
        const endTime = event.end ? event.end.format('HH:mm') : 'No end time set';

        reminderDetails.innerHTML = `
            <p><strong>Description:</strong> ${event.title}</p>
            <p><strong>Date:</strong> ${event.start.format('YYYY-MM-DD')}</p>
            <p><strong>Time:</strong> ${event.start.format('HH:mm')} - ${endTime}</p>
        `;

        const editLink = document.getElementById('edit-reminder-link');
        const deleteLink = document.getElementById('delete-reminder-link');
        editLink.href = `update/${event.id}`; // Replace with actual URL structure
        deleteLink.href = `delete/${event.id}`; // Replace with actual URL structure

        document.getElementById('view-reminder-modal').classList.remove('hidden');
    }

    function closeViewModal() {
        document.getElementById('view-reminder-modal').classList.add('hidden');
    }
</script>

{% endblock %}
