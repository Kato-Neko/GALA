{% extends 'base.html' %}

{% block content %}
<div class="w-screen h-screen pt-10" style="background: rgba(3, 2, 84, 0.4);">
    <div class="grid grid-cols-7 gap-4 pt-20 ">

        <div class="col-span-1">
        </div>

        <div class="center-rectangle col-span-2 shadow-xl p-10 rounded-2xl max-w-xl h-full w-full relative"
    style="background: rgba(3, 2, 84, 0.4);">
    <!-- Overlay -->
    <div class="absolute inset-0 bg-black bg-opacity-40 rounded-2xl z-0"></div>

    <!-- Scrollable Event List -->
    <div class="relative mt-4 space-y-6 h-full overflow-y-auto z-10">
        {% for reminder in object_list|dictsort:"date" %}
        <div class="event-item group relative p-4 rounded-2xl"
            style="background: rgb(255, 255, 255); --index: {{ forloop.counter0 }}">
            {% if reminder.image %}
            <img src="{{ reminder.image.url }}" alt="{{ reminder.description }}"
                class="w-full h-32 object-cover rounded-lg mb-4">
            {% endif %}
            <h4 class="font-bold text-lg">{{ reminder.description }}</h4>
            <p>{{ reminder.date }} at {{ reminder.start_time }}</p>
            <p>Longitude: {{ reminder.longitude }} Latitude: {{ reminder.latitude }}</p>
        </div>
        {% empty %}
        <p class="text-center text-gray-300">No upcoming reminders.</p>
        {% endfor %}
    </div>
</div>


        <!-- Calendar -->
        <div id="calendar-container"
            class="col-span-3 shadow-xl mt-5 p-5 rounded-2xl pb-7 flex justify-center items-center w-auto h-[700px] overflow-hidden"
            style="background: rgba(3, 2, 84, 0.4); color:rgba(255, 255, 255, 1);">
            <div id="calendar">
            </div>
        </div>

    </div>
</div>

<!-- Create Reminder Modal -->
<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden" id="reminder-modal">
    <div class="bg-white p-8 rounded-lg shadow-lg max-w-sm w-full">
        <h2 class="text-xl font-bold mb-4">Create Reminder</h2>
        <form method="post" action="{% url 'reminder-create' %}" id="reminder-form" enctype="multipart/form-data"> <!-- Add enctype -->
            {% csrf_token %}
            <label for="description" class="block text-sm font-medium mb-2">Description:</label>
            <input type="text" name="description" required class="w-full p-2 mb-4 border rounded-md">
        
            <label for="start_time" class="block text-sm font-medium mb-2">Start Time:</label>
            <input type="time" name="start_time" required class="w-full p-2 mb-4 border rounded-md">
        
            <label for="end_time" class="block text-sm font-medium mb-2">End Time:</label>
            <input type="time" name="end_time" required class="w-full p-2 mb-4 border rounded-md">
        
            <label for="longitude" class="block text-sm font-medium mb-2">Longitude:</label>
            <input type="text" name="longitude" class="w-full p-2 mb-4 border rounded-md">
        
            <label for="latitude" class="block text-sm font-medium mb-2">Latitude:</label>
            <input type="text" name="latitude" class="w-full p-2 mb-4 border rounded-md">
        
            <label for="image" class="block text-sm font-medium mb-2">Upload Image:</label>
            <input type="file" name="image" class="w-full p-2 mb-4 border rounded-md"> <!-- Add this -->
        
            <input type="hidden" name="date" id="selected-date">
        
            <button type="submit" class="w-full bg-blue-500 text-white py-2 rounded-md hover:bg-blue-700">Save</button>
        </form>        
        <button class="w-full mt-4 bg-red-500 text-white py-2 rounded-md hover:bg-red-700"
            onclick="closeCreateModal()">Close</button>
    </div>
</div>

<!-- View Reminder Modal -->
<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden" id="view-reminder-modal">
    <div class="bg-white p-8 rounded-lg shadow-lg max-w-sm w-full">
        <h2 class="text-xl font-bold mb-4">Reminder Details</h2>
        <div id="reminder-details">
            <!-- Reminder details will be populated dynamically -->
        </div>
        <div class="flex justify-between mt-4">
            <a id="edit-reminder-link"
                class="px-4 py-2 bg-yellow-500 text-white rounded-md hover:bg-yellow-700">Edit</a>
            <a id="delete-reminder-link" class="px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-700">Delete</a>
        </div>
        <button class="w-full mt-4 bg-gray-500 text-white py-2 rounded-md hover:bg-gray-700"
            onclick="closeViewModal()">Close</button>
    </div>
</div>

<script>
    $(document).ready(function () {
        $('#calendar').fullCalendar({
            header: {
                left: 'prev,next today',
                center: 'title',
                right: 'month,agendaWeek,agendaDay'
            },
            events: {{ events| safe }},
        dayClick: function (date, jsEvent, view) {
            const today = moment().startOf('day');
            if (date.isBefore(today)) {
                alert("You cannot create a reminder for a past date.");
                return;
            }
            openCreateModal(date.format());
        },
        eventClick: function (event, jsEvent, view) {
            openViewModal(event);
        }
        });
    });

    function openCreateModal(date) {
        document.getElementById('selected-date').value = date;
        document.getElementById('reminder-modal').classList.remove('hidden');
    }

    function closeCreateModal() {
        document.getElementById('reminder-modal').classList.add('hidden');
    }

    function openViewModal(event) {
        const reminderDetails = document.getElementById('reminder-details');
        const endTime = event.end ? event.end.format('HH:mm') : 'No end time set';
        const longitude = event.longitude ? event.longitude : 'Not provided';
        const latitude = event.latitude ? event.latitude : 'Not provided';

        reminderDetails.innerHTML = `
            <p><strong>Description:</strong> ${event.title}</p>
            <p><strong>Date:</strong> ${event.start.format('YYYY-MM-DD')}</p>
            <p><strong>Time:</strong> ${event.start.format('HH:mm')} - ${endTime}</p>
            <p><strong>Location:</strong> Latitude ${latitude}, Longitude ${longitude}</p>
        `;

        const editLink = document.getElementById('edit-reminder-link');
        const deleteLink = document.getElementById('delete-reminder-link');
        editLink.href = `update/${event.id}`; // Replace with actual URL structure
        deleteLink.href = `delete/${event.id}`; // Replace with actual URL structure

        document.getElementById('view-reminder-modal').classList.remove('hidden');
    }

    function closeViewModal() {
        document.getElementById('view-reminder-modal').classList.add('hidden');
    }
</script>

{% endblock %}