{% extends 'base.html' %}
{% load static %}

{% block title %}
Account Management
{% endblock %}

{% block content %}
<div class="container mx-auto mt-5 p-8 max-w-3xl bg-dark text-white rounded-lg shadow-md">
    <!-- Header Section -->
    <h2 class="text-4xl font-bold text-center text-white mb-5">Manage Your Profile</h2>
    <p class="text-sm text-center text-gray-200 mb-5">Update your details or delete your account.</p>

    <!-- Form Section -->
    <form method="post" enctype="multipart/form-data" class="space-y-6">
        {% csrf_token %}

        <!-- Profile Picture Section -->
        <div class="w-32 h-32 rounded-full overflow-hidden bg-gray-200 flex items-center justify-center">
            {% if user.is_authenticated %}
            {% if user.profile.profile_picture %}
            <img id="profile-picture-preview" src="{{ user.profile.profile_picture.url }}" alt="Profile Picture"
                class="object-cover w-full h-full">
            {% else %}
            <span class="text-4xl font-medium text-gray-500">?</span>
            {% endif %}
            {% else %}
            <span class="text-4xl font-medium text-gray-500">?</span>
            {% endif %}
        </div>

        <!-- Username Field -->
        <div>
            <label for="username" class="block text-sm font-semibold text-white mb-1">Username</label>
            <input type="text" name="username" id="username" value="{{ user.username }}"
                class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring focus:ring-blue-400 focus:outline-none text-gray-900">
        </div>

        <!-- First Name Field -->
        <div>
            <label for="first_name" class="block text-sm font-semibold text-white mb-1">First Name</label>
            <input type="text" name="first_name" id="first_name" value="{{ user.first_name }}"
                class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring focus:ring-blue-400 focus:outline-none text-gray-900">
        </div>

        <!-- Last Name Field -->
        <div>
            <label for="last_name" class="block text-sm font-semibold text-white mb-1">Last Name</label>
            <input type="text" name="last_name" id="last_name" value="{{ user.last_name }}"
                class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring focus:ring-blue-400 focus:outline-none text-gray-900">
        </div>

        <!-- Password Field -->
        <div>
            <label for="password" class="block text-sm font-semibold text-white mb-1">Password</label>
            <input type="password" name="password" id="password"
                class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring focus:ring-blue-400 focus:outline-none text-gray-900">
        </div>

        <!-- Submit Button -->
        <button type="submit"
            class="w-full py-3 px-6 bg-blue-500 text-white rounded-lg font-bold hover:bg-blue-600 transition">
            Update Account
        </button>
    </form>

    <hr class="my-6 border-gray-400">

    <!-- Delete Account Section -->
    <div class="text-center">
        <button onclick="openDeleteModal()"
            class="w-full py-3 px-6 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg font-bold hover:from-red-600 hover:to-red-700 transition">
            Delete Account
        </button>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal"
    class="hidden fixed inset-0 flex items-center justify-center bg-gray-900 bg-opacity-50 backdrop-blur-md z-[9999]">
    <div class="bg-white p-6 rounded-lg shadow-lg max-w-sm w-full text-center">
        <h2 class="text-xl font-bold text-gray-800 mb-4">Confirm Account Deletion</h2>
        <p class="text-sm text-gray-600 mb-6">This action cannot be undone. Are you sure you want to delete your
            account?</p>
        <div class="flex gap-4 justify-center">
            <button onclick="closeDeleteModal()"
                class="px-6 py-2 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400 transition">Cancel</button>
            <form method="post" action="{% url 'delete_account' %}">
                {% csrf_token %}
                <button type="submit"
                    class="px-6 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition">Confirm</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .bg-dark {
        background-color: #00386d;
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    function openDeleteModal() {
        document.getElementById("deleteModal").classList.remove("hidden");
        document.getElementById("deleteModal").classList.add("flex");
    }

    function closeDeleteModal() {
        document.getElementById("deleteModal").classList.add("hidden");
        document.getElementById("deleteModal").classList.remove("flex");
    }

    document.getElementById('profile_picture').addEventListener('change', function (event) {
        const file = event.target.files[0]; // Get the selected file
        if (file) {
            const preview = document.getElementById('profile-picture-preview'); // Target the image element
            preview.src = URL.createObjectURL(file); // Set the image source to the uploaded file
            preview.onload = () => URL.revokeObjectURL(preview.src); // Clean up after loading
        }
    });
</script>
{% endblock %}